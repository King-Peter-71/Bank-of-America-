<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - Bank of America</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* Bank of America Style - Admin Dashboard */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    }

    :root {
      --boa-red: #E31837;
      --boa-dark-blue: #12326B;
      --boa-white: #ffffff;
      --boa-light-gray: #f5f7fa;
      --boa-gray: #767676;
      --boa-dark-gray: #333333;
      --boa-border: #e5e5e5;
      --boa-background: #f3f3f3;
      --boa-green: #26a65b;
    }

    body {
      background-color: var(--boa-light-gray);
      margin: 0;
      padding: 0;
      color: var(--boa-dark-gray);
    }

    .admin-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    /* Header */
    .admin-header {
      background-color: var(--boa-dark-blue);
      color: var(--boa-white);
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      border-radius: 5px;
    }

    .admin-title {
      font-size: 24px;
      font-weight: bold;
    }

    .admin-user {
      display: flex;
      align-items: center;
    }

    .admin-user-name {
      margin-right: 10px;
    }

    .logout-btn {
      background-color: var(--boa-red);
      color: var(--boa-white);
      border: none;
      padding: 8px 15px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }

    /* Tabs */
    .tabs {
      margin-bottom: 20px;
    }

    .tab-buttons {
      display: flex;
      border-bottom: 1px solid var(--boa-border);
      margin-bottom: 20px;
    }

    .tab-btn {
      padding: 10px 20px;
      background: none;
      border: none;
      border-bottom: 3px solid transparent;
      cursor: pointer;
      font-weight: bold;
      color: var(--boa-gray);
    }

    .tab-btn.active {
      color: var(--boa-red);
      border-bottom-color: var(--boa-red);
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* Cards */
    .card {
      background-color: var(--boa-white);
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      padding: 20px;
      margin-bottom: 20px;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .card-title {
      font-size: 20px;
      font-weight: bold;
    }

    /* Tables */
    .table {
      width: 100%;
      border-collapse: collapse;
    }

    .table th, .table td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid var(--boa-border);
    }

    .table th {
      font-weight: bold;
      background-color: var(--boa-light-gray);
    }

    .table tr:last-child td {
      border-bottom: none;
    }

    /* Forms */
    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      font-weight: bold;
      margin-bottom: 8px;
    }

    .form-input {
      width: 100%;
      padding: 10px 15px;
      border: 1px solid var(--boa-border);
      border-radius: 5px;
      font-size: 16px;
    }

    .form-input:focus {
      outline: none;
      border-color: var(--boa-dark-blue);
    }

    .form-button {
      background-color: var(--boa-red);
      color: var(--boa-white);
      border: none;
      padding: 12px 20px;
      border-radius: 5px;
      font-weight: bold;
      cursor: pointer;
    }

    /* Status Badges */
    .status-badge {
      display: inline-block;
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: bold;
    }

    .status-active {
      background-color: rgba(38, 166, 91, 0.1);
      color: var(--boa-green);
    }

    .status-inactive {
      background-color: rgba(231, 76, 60, 0.1);
      color: var(--boa-red);
    }

    /* Action Buttons */
    .action-btn {
      background: none;
      border: none;
      color: var(--boa-dark-blue);
      cursor: pointer;
      margin-right: 10px;
      font-size: 16px;
    }

    .action-btn:hover {
      color: var(--boa-red);
    }

    .action-btn.delete {
      color: var(--boa-red);
    }

    /* Messages */
    .message {
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 20px;
      display: none;
    }

    .message.success {
      background-color: rgba(38, 166, 91, 0.1);
      border: 1px solid rgba(38, 166, 91, 0.3);
      color: var(--boa-green);
    }

    .message.error {
      background-color: rgba(231, 76, 60, 0.1);
      border: 1px solid rgba(231, 76, 60, 0.3);
      color: var(--boa-red);
    }
  </style>
</head>
<body>
  <div class="admin-container">
    <!-- Header -->
    <header class="admin-header">
      <div class="admin-title">Bank of America Admin</div>
      <div class="admin-user">
        <div class="admin-user-name">Admin User</div>
        <button class="logout-btn" id="logout-btn">Logout</button>
      </div>
    </header>

    <!-- Tabs -->
    <div class="tabs">
      <div class="tab-buttons">
        <button class="tab-btn active" data-tab="users">Users</button>
        <button class="tab-btn" data-tab="fund">Fund Users</button>
        <button class="tab-btn" data-tab="transactions">Transactions</button>
      </div>

      <!-- Users Tab -->
      <div class="tab-content active" id="users-tab">
        <div class="card">
          <div class="card-header">
            <div class="card-title">User Management</div>
          </div>
          <div class="message success" id="users-success-message"></div>
          <div class="message error" id="users-error-message"></div>
          <table class="table" id="users-table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Account Number</th>
                <th>Balance</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="users-table-body">
              <!-- Users will be loaded here -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- Fund Users Tab -->
      <div class="tab-content" id="fund-tab">
        <div class="card">
          <div class="card-header">
            <div class="card-title">Fund User Account</div>
          </div>
          <div class="message success" id="fund-success-message"></div>
          <div class="message error" id="fund-error-message"></div>
          <form id="fund-user-form">
            <div class="form-group">
              <label class="form-label" for="account-number">Account Number</label>
              <input type="text" class="form-input" id="account-number" placeholder="Enter user's account number" required>
            </div>
            <div class="form-group">
              <label class="form-label" for="fund-amount">Amount</label>
              <input type="number" class="form-input" id="fund-amount" placeholder="Enter amount to fund" step="0.01" min="0.01" required>
            </div>
            <div class="form-group">
              <label class="form-label" for="fund-note">Note (Optional)</label>
              <input type="text" class="form-input" id="fund-note" placeholder="Add a note for this transaction">
            </div>
            <button type="submit" class="form-button">Fund Account</button>
          </form>
        </div>
      </div>

      <!-- Transactions Tab -->
      <div class="tab-content" id="transactions-tab">
        <div class="card">
          <div class="card-header">
            <div class="card-title">All Transactions</div>
          </div>
          <table class="table" id="transactions-table">
            <thead>
              <tr>
                <th>Date</th>
                <th>From</th>
                <th>To</th>
                <th>Amount</th>
                <th>Type</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="transactions-table-body">
              <!-- Transactions will be loaded here -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // Check if admin is logged in
      const userString = localStorage.getItem("user");
      let user = null;

      if (userString) {
        try {
          user = JSON.parse(userString);
          // For demo purposes, we'll consider any user with admin role as admin
          // In a real app, you would check for admin role
          if (user.role !== "admin") {
            window.location.href = "login.html";
            return;
          }
        } catch (e) {
          console.error("Error parsing user data:", e);
          window.location.href = "login.html";
          return;
        }
      } else {
        window.location.href = "login.html";
        return;
      }

      // Handle tab switching
      const tabButtons = document.querySelectorAll(".tab-btn");
      const tabContents = document.querySelectorAll(".tab-content");

      tabButtons.forEach(button => {
        button.addEventListener("click", () => {
          // Remove active class from all buttons and contents
          tabButtons.forEach(btn => btn.classList.remove("active"));
          tabContents.forEach(content => content.classList.remove("active"));

          // Add active class to clicked button and corresponding content
          button.classList.add("active");
          const tabId = button.getAttribute("data-tab") + "-tab";
          document.getElementById(tabId).classList.add("active");
        });
      });

      // Handle logout
      const logoutBtn = document.getElementById("logout-btn");
      if (logoutBtn) {
        logoutBtn.addEventListener("click", () => {
          localStorage.removeItem("isLoggedIn");
          localStorage.removeItem("user");
          window.location.href = "login.html";
        });
      }

      // Load users
      loadUsers();

      // Load transactions
      loadTransactions();

      // Handle fund user form
      const fundUserForm = document.getElementById("fund-user-form");
      const fundSuccessMessage = document.getElementById("fund-success-message");
      const fundErrorMessage = document.getElementById("fund-error-message");

      if (fundUserForm) {
        fundUserForm.addEventListener("submit", (e) => {
          e.preventDefault();

          const accountNumber = document.getElementById("account-number").value;
          const amount = parseFloat(document.getElementById("fund-amount").value);
          const note = document.getElementById("fund-note").value;

          // Validate inputs
          if (!accountNumber) {
            fundErrorMessage.textContent = "Please enter an account number";
            fundErrorMessage.style.display = "block";
            fundSuccessMessage.style.display = "none";
            return;
          }

          if (isNaN(amount) || amount <= 0) {
            fundErrorMessage.textContent = "Please enter a valid amount";
            fundErrorMessage.style.display = "block";
            fundSuccessMessage.style.display = "none";
            return;
          }

          // Get all users
          let users = [];
          const usersString = localStorage.getItem("users");
          if (usersString) {
            try {
              users = JSON.parse(usersString);
            } catch (e) {
              console.error("Error parsing users:", e);
            }
          }

          // Find user by account number
          const userToFund = users.find(u => u.accountNumber === accountNumber);
          if (!userToFund) {
            fundErrorMessage.textContent = "User with this account number not found";
            fundErrorMessage.style.display = "block";
            fundSuccessMessage.style.display = "none";
            return;
          }

          // Update user balance
          userToFund.balance = (userToFund.balance || 0) + amount;

          // Update users in localStorage
          localStorage.setItem("users", JSON.stringify(users));

          // If the funded user is the currently logged in user, update their data
          if (user.accountNumber === accountNumber) {
            user.balance = userToFund.balance;
            localStorage.setItem("user", JSON.stringify(user));
          }

          // Create transaction record
          const transaction = {
            senderAccountNumber: "ADMIN",
            senderName: "Admin",
            recipientAccountNumber: accountNumber,
            recipientName: userToFund.name,
            amount: amount,
            note: note || "Admin funding",
            date: new Date().toISOString(),
            status: "completed",
            type: "admin-fund"
          };

          // Save transaction
          let transactions = [];
          const transactionsString = localStorage.getItem("transactions");
          if (transactionsString) {
            try {
              transactions = JSON.parse(transactionsString);
            } catch (e) {
              console.error("Error parsing transactions:", e);
            }
          }
          transactions.push(transaction);
          localStorage.setItem("transactions", JSON.stringify(transactions));

          // Show success message
          fundSuccessMessage.textContent = `Successfully funded ${userToFund.name}'s account with $${amount.toFixed(2)}`;
          fundSuccessMessage.style.display = "block";
          fundErrorMessage.style.display = "none";

          // Reset form
          fundUserForm.reset();

          // Reload users and transactions
          loadUsers();
          loadTransactions();
        });
      }
    });

    // Function to load users
    function loadUsers() {
      const usersTableBody = document.getElementById("users-table-body");
      if (!usersTableBody) return;

      // Get users from localStorage
      let users = [];
      const usersString = localStorage.getItem("users");
      if (usersString) {
        try {
          users = JSON.parse(usersString);
        } catch (e) {
          console.error("Error parsing users:", e);
        }
      }

      // Clear table
      usersTableBody.innerHTML = "";

      // Add users to table
      users.forEach(user => {
        if (user.role !== "admin") { // Don't show admin users
          const row = document.createElement("tr");
          
          const formattedBalance = (user.balance || 0).toLocaleString(undefined, {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
          });
          
          row.innerHTML = `
            <td>${user.name}</td>
            <td>${user.email}</td>
            <td>${user.accountNumber}</td>
            <td>$${formattedBalance}</td>
            <td><span class="status-badge status-active">Active</span></td>
            <td>
              <button class="action-btn fund-btn" data-account="${user.accountNumber}"><i class="fas fa-money-bill"></i></button>
              <button class="action-btn delete delete-btn" data-account="${user.accountNumber}"><i class="fas fa-trash"></i></button>
            </td>
          `;
          
          usersTableBody.appendChild(row);
        }
      });

      // Add event listeners to fund buttons
      const fundBtns = document.querySelectorAll(".fund-btn");
      fundBtns.forEach(btn => {
        btn.addEventListener("click", () => {
          const accountNumber = btn.getAttribute("data-account");
          
          // Switch to fund tab
          document.querySelector('.tab-btn[data-tab="fund"]').click();
          
          // Fill account number field
          document.getElementById("account-number").value = accountNumber;
        });
      });

      // Add event listeners to delete buttons
      const deleteBtns = document.querySelectorAll(".delete-btn");
      const usersSuccessMessage = document.getElementById("users-success-message");
      const usersErrorMessage = document.getElementById("users-error-message");
      
      deleteBtns.forEach(btn => {
        btn.addEventListener("click", () => {
          const accountNumber = btn.getAttribute("data-account");
          
          // Confirm deletion
          if (confirm("Are you sure you want to delete this user?")) {
            // Get users from localStorage
            let users = [];
            const usersString = localStorage.getItem("users");
            if (usersString) {
              try {
                users = JSON.parse(usersString);
                
                // Find user index
                const userIndex = users.findIndex(u => u.accountNumber === accountNumber);
                
                if (userIndex !== -1) {
                  // Remove user
                  users.splice(userIndex, 1);
                  
                  // Update localStorage
                  localStorage.setItem("users", JSON.stringify(users));
                  
                  // Show success message
                  usersSuccessMessage.textContent = "User deleted successfully";
                  usersSuccessMessage.style.display = "block";
                  usersErrorMessage.style.display = "none";
                  
                  // Reload users
                  loadUsers();
                } else {
                  // Show error message
                  usersErrorMessage.textContent = "User not found";
                  usersErrorMessage.style.display = "block";
                  usersSuccessMessage.style.display = "none";
                }
              } catch (e) {
                console.error("Error parsing users:", e);
                
                // Show error message
                usersErrorMessage.textContent = "An error occurred. Please try again.";
                usersErrorMessage.style.display = "block";
                usersSuccessMessage.style.display = "none";
              }
            }
          }
        });
      });
    }

    // Function to load transactions
    function loadTransactions() {
      const transactionsTableBody = document.getElementById("transactions-table-body");
      if (!transactionsTableBody) return;

      // Get transactions from localStorage
      let transactions = [];
      const transactionsString = localStorage.getItem("transactions");
      if (transactionsString) {
        try {
          transactions = JSON.parse(transactionsString);
        } catch (e) {
          console.error("Error parsing transactions:", e);
        }
      }

      // Sort by date (newest first)
      transactions.sort((a, b) => new Date(b.date) - new Date(a.date));

      // Clear table
      transactionsTableBody.innerHTML = "";

      // Add transactions to table
      transactions.forEach(transaction => {
        const row = document.createElement("tr");
        
        const formattedDate = new Date(transaction.date).toLocaleString();
        const formattedAmount = transaction.amount.toLocaleString(undefined, {
          minimumFractionDigits: 2,
          maximumFractionDigits: 2
        });
        
        const transactionType = transaction.type === "admin-fund" ? "Admin Funding" : "Transfer";
        
        row.innerHTML = `
          <td>${formattedDate}</td>
          <td>${transaction.senderName} (${transaction.senderAccountNumber})</td>
          <td>${transaction.recipientName} (${transaction.recipientAccountNumber})</td>
          <td>$${formattedAmount}</td>
          <td>${transactionType}</td>
          <td><span class="status-badge status-active">${transaction.status || "completed"}</span></td>
        `;
        
        transactionsTableBody.appendChild(row);
      });
    }
  </script>
</body>
</html>